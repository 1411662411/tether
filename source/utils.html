<!DOCTYPE html>

<html>
<head>
  <title>utils.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="Gruntfile.html">
                Gruntfile.coffee
              </a>
            
              
              <a class="source" href="abutment.html">
                abutment.coffee
              </a>
            
              
              <a class="source" href="constraint.html">
                constraint.coffee
              </a>
            
              
              <a class="source" href="markAttachment.html">
                markAttachment.coffee
              </a>
            
              
              <a class="source" href="shift.html">
                shift.coffee
              </a>
            
              
              <a class="source" href="tether.html">
                tether.coffee
              </a>
            
              
              <a class="source" href="tooltip.html">
                tooltip.coffee
              </a>
            
              
              <a class="source" href="utils.html">
                utils.coffee
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>utils.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>window.Tether ?= {}

<span class="function"><span class="title">getScrollParent</span></span> = (el) -&gt;
  position = getComputedStyle(el).position

  <span class="keyword">if</span> position <span class="keyword">is</span> <span class="string">'fixed'</span>
    <span class="keyword">return</span> el

  scrollParent = <span class="literal">undefined</span>

  parent = el
  <span class="keyword">while</span> parent = parent.parentNode
    <span class="keyword">unless</span> style = getComputedStyle parent
      <span class="keyword">return</span> parent

    <span class="keyword">if</span> <span class="regexp">/(auto|scroll)/</span>.test(style[<span class="string">'overflow'</span>] + style[<span class="string">'overflow-y'</span>] + style[<span class="string">'overflow-x'</span>])
      <span class="keyword">if</span> position <span class="keyword">isnt</span> <span class="string">'absolute'</span> <span class="keyword">or</span> style[<span class="string">'position'</span>] <span class="keyword">in</span> [<span class="string">'relative'</span>, <span class="string">'absolute'</span>, <span class="string">'fixed'</span>]
        <span class="keyword">return</span> parent

  <span class="keyword">return</span> document.body

<span class="function"><span class="title">getBounds</span></span> = (el) -&gt;
  doc = el.ownerDocument
  docEl = doc.documentElement

  box = extend {}, el.getBoundingClientRect()

  box.top = box.top + window.pageYOffset - docEl.clientTop
  box.left = box.left + window.pageXOffset - docEl.clientLeft
  box.right = doc.body.clientWidth - box.width - box.left
  box.bottom = doc.body.clientHeight - box.height - box.top

  <span class="keyword">if</span> <span class="keyword">not</span> box.height <span class="keyword">or</span> <span class="keyword">not</span> box.width</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>When the element is hidden it doesn&#39;t have a bounding
rect, but we still need it&#39;s size to know if it should still
be invisible in the next frame.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    style = getComputedStyle el

    box.height <span class="keyword">or</span>= parseFloat style.height
    box.width <span class="keyword">or</span>= parseFloat style.width

  box

<span class="function"><span class="title">getOffsetParent</span></span> = (el) -&gt;
  el.offsetParent <span class="keyword">or</span> document.documentElement

<span class="function"><span class="title">extend</span></span> = (out={}) -&gt;
  args = []
  Array::push.apply(args, arguments)

  <span class="keyword">for</span> obj <span class="keyword">in</span> args[<span class="number">1.</span>.] <span class="keyword">when</span> obj
    <span class="keyword">for</span> own key, val <span class="keyword">of</span> obj
      out[key] = val

  out

<span class="function"><span class="title">removeClass</span></span> = (el, name) -&gt;
  <span class="keyword">if</span> el.classList?
    el.classList.remove(cls) <span class="keyword">for</span> cls <span class="keyword">in</span> name.split(<span class="string">' '</span>)
  <span class="keyword">else</span>
    el.className = el.className.replace <span class="keyword">new</span> RegExp(<span class="string">"(^| )<span class="subst">#{ name.split(' ').join('|') }</span>( |$)"</span>, <span class="string">'gi'</span>), <span class="string">' '</span>

<span class="function"><span class="title">addClass</span></span> = (el, name) -&gt;
  <span class="keyword">if</span> el.classList?
    el.classList.add(cls) <span class="keyword">for</span> cls <span class="keyword">in</span> name.split(<span class="string">' '</span>)
  <span class="keyword">else</span>
    removeClass el, name
    el.className += <span class="string">" <span class="subst">#{ name }</span>"</span>

<span class="function"><span class="title">hasClass</span></span> = (el, name) -&gt;
  <span class="keyword">if</span> el.classList?
    el.classList.contains(name)
  <span class="keyword">else</span>
    <span class="keyword">new</span> RegExp(<span class="string">"(^| )<span class="subst">#{ name }</span>( |$)"</span>, <span class="string">'gi'</span>).test(el.className)

<span class="class"><span class="keyword">class</span> <span class="title">Evented</span></span>
  <span class="literal">on</span>: (event, handler, ctx, once=<span class="literal">false</span>) -&gt;
    <span class="property">@bindings</span> ?= {}
    <span class="property">@bindings</span>[event] ?= []
    <span class="property">@bindings</span>[event].push {handler, ctx, once}

  once: (event, handler, ctx) -&gt;
    <span class="property">@on</span>(event, handler, ctx, <span class="literal">true</span>)

  <span class="literal">off</span>: (event, handler) -&gt;
    <span class="keyword">return</span> <span class="keyword">unless</span> <span class="property">@bindings</span>?[event]?

    <span class="keyword">if</span> <span class="keyword">not</span> handler?
      <span class="keyword">delete</span> <span class="property">@bindings</span>[event]
    <span class="keyword">else</span>
      i = <span class="number">0</span>
      <span class="keyword">while</span> i &lt; <span class="property">@bindings</span>[event].length
        <span class="keyword">if</span> <span class="property">@bindings</span>[event][i].handler <span class="keyword">is</span> handler
          <span class="property">@bindings</span>[event].splice i, <span class="number">1</span>
        <span class="keyword">else</span>
          i++

  trigger: (event, args...) -&gt;
    <span class="keyword">if</span> <span class="property">@bindings</span>?[event]
      i = <span class="number">0</span>
      <span class="keyword">while</span> i &lt; <span class="property">@bindings</span>[event].length
        {handler, ctx, once} = <span class="property">@bindings</span>[event][i]

        handler.apply(ctx ? @, args)

        <span class="keyword">if</span> once
          <span class="property">@bindings</span>[event].splice i, <span class="number">1</span>
        <span class="keyword">else</span>
          i++

Tether.Utils = {getScrollParent, getBounds, getOffsetParent, extend, addClass, removeClass, hasClass, Evented}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
